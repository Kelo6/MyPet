<!--pages/home/home.wxml-->
<!-- å¯¼å…¥å…¨å±€æ ·å¼ -->
<view class="home-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container animate-fade-in">
    <view class="loading-spinner animate-spin"></view>
    <text class="loading-text">æ­£åœ¨ä¸ºæ‚¨çš„æ¯›å­©å­å‡†å¤‡å¥åº·æ¡£æ¡ˆ...</text>
  </view>
  
  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="home-content">
    <!-- é¡¶éƒ¨æ¬¢è¿åŒºåŸŸ -->
    <view class="welcome-section animate-fade-in">
      <!-- èƒŒæ™¯è£…é¥° -->
      <view class="welcome-bg">
        <view class="bg-pattern"></view>
        <view class="bg-dots"></view>
      </view>
      
      <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
      <view class="user-info-card">
        <view wx:if="{{hasUserInfo}}" class="user-info">
          <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view class="user-details">
            <text class="username">{{userInfo.nickName}}</text>
            <text class="welcome-text">{{getWelcomeText()}}</text>
          </view>
          <view class="weather-info">
            <text class="weather-text">â˜€ï¸ ä»Šæ—¥é€‚åˆé›å® </text>
          </view>
        </view>
        <button wx:else class="user-info-btn" open-type="getUserInfo" bindgetuserinfo="getUserInfo">
          <view class="login-content">
            <text class="login-icon">ğŸ‘‹</text>
            <text class="login-text">ç‚¹å‡»ç™»å½•ï¼Œå¼€å§‹ä½¿ç”¨</text>
          </view>
        </button>
      </view>
    </view>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-section">
      <view class="stats-grid">
        <view class="stat-card primary" bindtap="goToPets">
          <view class="stat-icon">ğŸ¾</view>
          <text class="stat-number">{{pets.length}}</text>
          <text class="stat-label">æˆ‘çš„å® ç‰©</text>
        </view>
        <view class="stat-card {{overdueSchedules.length > 0 ? 'danger' : 'normal'}}" bindtap="goToReminders">
          <view class="stat-icon">âš ï¸</view>
          <text class="stat-number">{{overdueSchedules.length}}</text>
          <text class="stat-label">å·²é€¾æœŸ</text>
        </view>
        <view class="stat-card {{todaySchedules.length > 0 ? 'warning' : 'normal'}}" bindtap="goToSchedule">
          <view class="stat-icon">ğŸ“‹</view>
          <text class="stat-number">{{todaySchedules.length}}</text>
          <text class="stat-label">ä»Šæ—¥å¾…åŠ</text>
        </view>
        <view class="stat-card success" bindtap="goToSchedule">
          <view class="stat-icon">â°</view>
          <text class="stat-number">{{upcomingSchedules.length}}</text>
          <text class="stat-label">å³å°†åˆ°æœŸ</text>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„å® ç‰© -->
    <view wx:if="{{pets.length > 0}}" class="pets-section">
      <view class="section-header">
        <text class="section-title">æˆ‘çš„å® ç‰© ({{pets.length}})</text>
        <view class="section-action" bindtap="addPet">
          <text class="action-text">æ·»åŠ </text>
          <text class="action-icon">+</text>
        </view>
      </view>
      
      <scroll-view class="pets-scroll" scroll-x show-scrollbar="{{false}}">
        <view class="pets-list">
          <pet-card 
            wx:for="{{pets}}" 
            wx:key="_id"
            pet="{{item}}"
            compact="{{true}}"
            show-actions="{{false}}"
            vaccine-status="{{item.vaccineStatus || 'unknown'}}"
            deworm-status="{{item.dewormStatus || 'unknown'}}"
            bind:cardtap="onPetCardTap"
            bind:edit="onPetEdit"
            bind:detail="onPetDetail"
          />
        </view>
      </scroll-view>
    </view>

    <!-- ç©ºçŠ¶æ€ - æ— å® ç‰© -->
    <empty-state 
      wx:else
      icon="ğŸ¾"
      title="è¿˜æ²¡æœ‰æ·»åŠ å® ç‰©"
      description="æ·»åŠ æ‚¨çš„ç¬¬ä¸€åªæ¯›å­©å­ï¼Œå¼€å§‹ç§‘å­¦çš„å¥åº·ç®¡ç†ä¹‹æ—…"
      show-button="{{true}}"
      button-text="æ·»åŠ å® ç‰©"
      bind:buttontap="addPet"
    />

    <!-- 30å¤©å†…å¾…åŠæé†’ -->
    <view wx:if="{{recentSchedules.length > 0}}" class="schedules-section">
      <view class="section-header">
        <text class="section-title">è¿‘30å¤©å¾…åŠ</text>
        <view class="section-action" bindtap="goToSchedule">
          <text class="action-text">æŸ¥çœ‹å…¨éƒ¨</text>
          <text class="action-icon">></text>
        </view>
      </view>

      <!-- é€¾æœŸæé†’ -->
      <view wx:if="{{overdueSchedules.length > 0}}" class="urgent-alerts">
        <view class="alert-header">
          <text class="alert-title">âš ï¸ é€¾æœŸæé†’</text>
          <text class="alert-count">{{overdueSchedules.length}}é¡¹</text>
        </view>
        <view wx:for="{{overdueSchedules}}" wx:key="_id" wx:for-item="schedule" class="schedule-item urgent">
          <view class="schedule-info">
            <text class="schedule-title">{{getPetName(schedule.petId)}} - {{getScheduleTitle(schedule)}}</text>
            <text class="schedule-date overdue">é€¾æœŸ {{getOverdueDays(schedule.plannedDate)}} å¤©</text>
          </view>
          <view class="schedule-actions">
            <button class="action-btn complete" data-id="{{schedule._id}}" bindtap="completeSchedule" catch:tap="true">
              å®Œæˆ
            </button>
          </view>
        </view>
      </view>

      <!-- ä»Šæ—¥å¾…åŠ -->
      <view wx:if="{{todaySchedules.length > 0}}" class="today-tasks">
        <view class="tasks-header">
          <text class="tasks-title">ğŸ“‹ ä»Šæ—¥å¾…åŠ</text>
          <text class="tasks-count">{{todaySchedules.length}}é¡¹</text>
        </view>
        <view wx:for="{{todaySchedules}}" wx:key="_id" wx:for-item="schedule" class="schedule-item today">
          <view class="schedule-info">
            <text class="schedule-title">{{getPetName(schedule.petId)}} - {{getScheduleTitle(schedule)}}</text>
            <text class="schedule-date today-date">ä»Šå¤©</text>
          </view>
          <view class="schedule-actions">
            <button class="action-btn complete" data-id="{{schedule._id}}" bindtap="completeSchedule" catch:tap="true">
              å®Œæˆ
            </button>
          </view>
        </view>
      </view>

      <!-- å³å°†åˆ°æœŸ -->
      <view wx:if="{{upcomingSchedules.length > 0}}" class="upcoming-tasks">
        <view class="tasks-header">
          <text class="tasks-title">â° å³å°†åˆ°æœŸ</text>
          <text class="tasks-count">{{upcomingSchedules.length}}é¡¹</text>
        </view>
        <view wx:for="{{upcomingSchedules.slice(0, 5)}}" wx:key="_id" wx:for-item="schedule" class="schedule-item upcoming">
          <view class="schedule-info">
            <text class="schedule-title">{{getPetName(schedule.petId)}} - {{getScheduleTitle(schedule)}}</text>
            <text class="schedule-date upcoming-date">{{getRelativeDate(schedule.plannedDate)}}</text>
          </view>
          <view class="schedule-type">
            <text class="type-badge {{schedule.type}}">{{getTypeText(schedule.type)}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ - æ— å¾…åŠ -->
    <view wx:elif="{{pets.length > 0}}" class="no-schedules">
      <empty-state 
        icon="âœ…"
        title="æš‚æ— å¾…åŠäº‹é¡¹"
        description="æ‚¨çš„å® ç‰©å¥åº·ç®¡ç†ä¸€åˆ‡æ­£å¸¸ï¼"
        show-button="{{true}}"
        button-text="å»å®Œå–„è®¡åˆ’"
        bind:buttontap="goToSchedule"
      />
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="quick-actions">
      <view class="action-grid">
        <view class="action-item primary" bindtap="addPet">
          <view class="action-icon">ğŸ•</view>
          <text class="action-title">æ·»åŠ å® ç‰©</text>
          <text class="action-desc">å»ºç«‹å® ç‰©æ¡£æ¡ˆ</text>
        </view>
        <view class="action-item secondary" bindtap="goToSchedule">
          <view class="action-icon">ğŸ“…</view>
          <text class="action-title">å®Œå–„è®¡åˆ’</text>
          <text class="action-desc">è®¾ç½®ç–«è‹—é©±è™«</text>
        </view>
        <view class="action-item tertiary" bindtap="goToKnowledge">
          <view class="action-icon">ğŸ“š</view>
          <text class="action-title">å­¦ä¹ çŸ¥è¯†</text>
          <text class="action-desc">å® ç‰©æŠ¤ç†ç™¾ç§‘</text>
        </view>
      </view>
    </view>
  </view>
</view>
