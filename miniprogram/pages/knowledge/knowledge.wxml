<!--pages/knowledge/knowledge.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <view class="search-input-wrapper">
        <input 
          class="search-input" 
          type="text" 
          placeholder="æœç´¢å® ç‰©å¥åº·çŸ¥è¯†"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
          bindconfirm="onSearch"
        />
        <view class="search-icon" bindtap="onSearch">ğŸ”</view>
      </view>
      <view wx:if="{{searchKeyword}}" class="search-clear" bindtap="onClearSearch">
        <text class="clear-text">å–æ¶ˆ</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="category-section" wx:if="{{!searchKeyword}}">
    <scroll-view class="category-scroll" scroll-x="true">
      <view class="category-chips">
        <view 
          class="category-chip {{selectedCategory === 'all' ? 'active' : ''}}"
          bindtap="onCategorySelect"
          data-category="all"
        >
          <text class="chip-text">å…¨éƒ¨</text>
          <view wx:if="{{stats.total > 0}}" class="chip-badge">{{stats.total}}</view>
        </view>
        <view 
          wx:for="{{categories}}" 
          wx:key="value"
          class="category-chip {{selectedCategory === item.value ? 'active' : ''}}"
          bindtap="onCategorySelect"
          data-category="{{item.value}}"
        >
          <text class="chip-icon">{{item.icon}}</text>
          <text class="chip-text">{{item.label}}</text>
          <view wx:if="{{item.count > 0}}" class="chip-badge">{{item.count}}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-section">
    <!-- æœç´¢ç»“æœ -->
    <view wx:if="{{searchKeyword}}" class="search-results">
      <view class="search-header">
        <text class="search-title">æœç´¢ç»“æœ</text>
        <text class="search-count">æ‰¾åˆ° {{filteredArticles.length}} ç¯‡æ–‡ç« </text>
      </view>
      
      <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
      <view wx:if="{{filteredArticles.length > 0}}" class="search-list">
        <view 
          wx:for="{{filteredArticles}}" 
          wx:key="_id"
          class="search-item"
          bindtap="onArticleDetail"
          data-article="{{item}}"
        >
          <view class="search-item-content">
            <text class="search-item-title">{{item.title}}</text>
            <text class="search-item-summary">{{getArticleSummary(item.contentMD)}}</text>
            <view class="search-item-meta">
              <text class="meta-category">{{getCategoryLabel(item.category)}}</text>
              <text class="meta-date">{{formatDate(item.updatedAt)}}</text>
            </view>
          </view>
          <view class="search-item-arrow">></view>
        </view>
      </view>

      <!-- æœç´¢æ— ç»“æœ -->
      <view wx:else class="search-empty">
        <empty-state
          icon="ğŸ”"
          title="æœªæ‰¾åˆ°ç›¸å…³å†…å®¹"
          description="è¯•è¯•å…¶ä»–å…³é”®è¯ï¼Œæˆ–æµè§ˆåˆ†ç±»å†…å®¹"
          action-text="æµè§ˆå…¨éƒ¨"
          bind:action="onClearSearch"
        />
      </view>
    </view>

    <!-- åˆ†ç±»å†…å®¹ -->
    <view wx:else class="category-content">
      <!-- æ¨èæ–‡ç«  -->
      <view wx:if="{{selectedCategory === 'all'}}" class="featured-section">
        <view class="section-header">
          <text class="section-title">ğŸŒŸ æ¨èé˜…è¯»</text>
        </view>
        <scroll-view class="featured-scroll" scroll-x="true">
          <view class="featured-cards">
            <view 
              wx:for="{{featuredArticles}}" 
              wx:key="_id"
              class="featured-card"
              bindtap="onArticleDetail"
              data-article="{{item}}"
            >
              <view class="featured-image">
                <text class="featured-emoji">{{getCategoryIcon(item.category)}}</text>
              </view>
              <view class="featured-content">
                <text class="featured-title">{{item.title}}</text>
                <text class="featured-summary">{{getArticleSummary(item.contentMD)}}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- æ–‡ç« åˆ—è¡¨ -->
      <view class="articles-section">
        <view wx:if="{{selectedCategory !== 'all'}}" class="section-header">
          <text class="section-title">{{getCategoryLabel(selectedCategory)}}</text>
          <text class="section-count">{{filteredArticles.length}} ç¯‡æ–‡ç« </text>
        </view>

        <!-- æ–‡ç« åˆ—è¡¨ -->
        <view wx:if="{{filteredArticles.length > 0}}" class="articles-list">
          <view 
            wx:for="{{filteredArticles}}" 
            wx:key="_id"
            class="article-card"
            bindtap="onArticleDetail"
            data-article="{{item}}"
          >
            <view class="article-icon">
              <text class="icon-emoji">{{getCategoryIcon(item.category)}}</text>
            </view>
            <view class="article-content">
              <text class="article-title">{{item.title}}</text>
              <text class="article-summary">{{getArticleSummary(item.contentMD)}}</text>
              <view class="article-meta">
                <text class="meta-category">{{getCategoryLabel(item.category)}}</text>
                <text class="meta-date">{{formatDate(item.updatedAt)}}</text>
                <text class="meta-reading">{{getReadingTime(item.contentMD)}}åˆ†é’Ÿé˜…è¯»</text>
              </view>
            </view>
            <view class="article-arrow">></view>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view wx:else class="articles-empty">
          <empty-state
            icon="ğŸ“š"
            title="{{getEmptyTitle()}}"
            description="{{getEmptyDescription()}}"
            action-text="æµè§ˆå…¶ä»–åˆ†ç±»"
            bind:action="onResetCategory"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-button secondary" bindtap="onFeedback">
      <text class="button-icon">ğŸ’¬</text>
      <text class="button-text">æ„è§åé¦ˆ</text>
    </button>
    <button class="action-button primary" bindtap="onRequestContent">
      <text class="button-icon">ğŸ“</text>
      <text class="button-text">å†…å®¹å»ºè®®</text>
    </button>
  </view>
</view>




